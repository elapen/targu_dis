# Nginx configuration for targu.shyrak.kz
# Place this file in /etc/nginx/sites-available/targu.conf
# Then create symlink: sudo ln -s /etc/nginx/sites-available/targu.conf /etc/nginx/sites-enabled/

server {
    listen 80;
    server_name targu.shyrak.kz;

    location / {
        include proxy_params;
        proxy_pass http://localhost:3003;
        
        # WebSocket support for Socket.IO
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # Timeouts
        proxy_connect_timeout 300;
        proxy_send_timeout 300;
        proxy_read_timeout 300;
        send_timeout 300;
    }

    # Socket.IO specific path (longer timeouts for persistent connections)
    location /api/socket {
        include proxy_params;
        proxy_pass http://localhost:3003;
        
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # Longer timeouts for WebSocket
        proxy_connect_timeout 7d;
        proxy_send_timeout 7d;
        proxy_read_timeout 7d;
    }
}
